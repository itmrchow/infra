# 指定 pipeline，且由 docker runner 執行
kind: pipeline
type: docker
name: github-push-gitlab # 可自行定義的名稱

trigger:
  branch:
    - feature/drone # 指定觸發的 branch
  event:
    - push

platform:
  os: linux
  arch: arm64

steps:
  - name: dummy-step # 新增的假步驟
    image: alpine:latest # 使用輕量級的 alpine 映像
    commands:
      - echo "這是一個假的步驟，什麼都不做"

# mirror to gitlab
  - name: mirror to gitlab 
    image: alpine:latest 
    commands:
      - echo [clone mirror start]
      - apk add git
      - git clone --bare https://github.com/itmrchow/infra.git ./bare.git
      - cd ./bare.git
      - git remote add gitlab https://jeff.wu4:glpat-PRWQvEbnTW1pajF_Hz2U@gitlab.com/jefftestmirror/infra2.git
      - git push gitlab --mirror
      - echo [cloen mirror finish]
